<!DOCTYPE html>
<html>
  <head>

    

    <title>Leaflet Time Slider Example</title>
    <meta charset="utf-8" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link
      rel="stylesheet"
      href="http://cdn.leafletjs.com/leaflet-0.7.2/leaflet.css"
    />
    <!--[if lte IE 8
      ]><link
        rel="stylesheet"
        href="http://cdn.leafletjs.com/leaflet-0.5.1/leaflet.ie.css"
    /><![endif]-->
    <link
      rel="stylesheet"
      href="http://code.jquery.com/ui/1.9.2/themes/base/jquery-ui.css"
      type="text/css"
    />

    <!-- PRUNE CLUSTER STUFFF 
    
    	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.2.0/dist/leaflet.css"
  integrity="sha512-M2wvCLH6DSRazYeZRIm1JnYyh22purTM+FDB5CsyxtQJYeKq83arPe5wgbNmcFXGqiSH2XR8dT/fJISVA1r/zQ=="
  crossorigin=""/>

	<script src="https://unpkg.com/leaflet@1.2.0/dist/leaflet.js"
  integrity="sha512-lInM/apFSqyy1o6s89K4iQUKg6ppXEgsVxT35HbzUupEVRh2Eu9Wdl4tHj7dZO0s1uvplcYGmt3498TtHq+log=="
  crossorigin=""></script>
  <script src="PruneCluster/dist/PruneCluster.js"></script>
-->
  {% load static %}
  </head>

  <body>
    <h1><a>Tractor-Trailer Maps </a>

    <div id="map" style="width: 100%; height: 600px"></div>

    <script src="http://cdn.leafletjs.com/leaflet-0.7.2/leaflet.js"></script>
    <script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
    <script src="http://code.jquery.com/ui/1.9.2/jquery-ui.js"></script>

    <script src="PruneCluster/dist/PruneCluster.js"></script>


    <!-- Include this library for mobile touch support  -->
    <script src="http://cdnjs.cloudflare.com/ajax/libs/jqueryui-touch-punch/0.2.2/jquery.ui.touch-punch.min.js"></script>

    <script src="{% static "SliderControl.js" %}"></script>


    <script>

      // testing prune cluster 

      // import { PruneCluster, PruneClusterForLeaflet } from 'exports-loader?PruneCluster,PruneClusterForLeaflet!prunecluster/dist/PruneCluster.js'

      // var pruneCluster = new PruneClusterForLeaflet();

      // var marker = new PruneCluster.Marker(59.8717, 11.1909);
      // var marker1 = new PruneCluster.Marker(59.8717, 11.1909);
      // var marker2 = new PruneCluster.Marker(59.8717, 11.1909);
      // pruneCluster.RegisterMarker([marker,marker1,marker2]);
      // leafletMap.addLayer(pruneCluster);

      // OtherData and Location data are the xlsx and csv files 
       var otherData = {{ other_data | safe }};
       var locationData = {{ location_data | safe }};

          // Map with US Boundaries 
       // var southWest = L.latLng(24.7433195, -124.7844079),
       // northEast = L.latLng(49.3457868, -66.9513812),
       // bounds = L.latLngBounds(southWest, northEast);

      // Creating map with openstreet map attribute  
       var myMap = L.map("map", {
    //     // maxBounds: bounds
       }).setView([48, -102], 4);

       L.tileLayer("http://{s}.tile.osm.org/{z}/{x}/{y}.png", {
         attribution:
           '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
       }).addTo(myMap);

      //An Array to retrive coordinates - long lat given a location
      function retrivecoordinates(location){
        for(x =0;x<=661;x++){
          if (locationData['location'][x] == location ){
            return [locationData['latitude'][x],locationData['longitude'][x]];
          }
        }
        return [0,0];
      }

      // creating an array of markers 
      var arrayMarkers = [];

      // Plotting the last 1000 units in a time series sldier 
      for(i = 0;i<1000;i++){
        var marker = L.marker(retrivecoordinates(otherData['location'][i].toString()),
         {time: otherData["saledate"][i]});
        arrayMarkers.push(marker);
      }

      // adding sliders to map
      layerGroup = L.layerGroup(arrayMarkers);
      var sliderControl = L.control.sliderControl({layer:layerGroup});
      myMap.addControl(sliderControl);
      sliderControl.startSlider();

    </script>
  </body>
</html>
