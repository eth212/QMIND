<!DOCTYPE html>
<html>
  <head>
    <title>Leaflet Time Slider Example</title>
    <meta charset="utf-8" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.2.0/dist/leaflet.css"
  integrity="sha512-M2wvCLH6DSRazYeZRIm1JnYyh22purTM+FDB5CsyxtQJYeKq83arPe5wgbNmcFXGqiSH2XR8dT/fJISVA1r/zQ=="
  crossorigin=""/>

    <link
      rel="stylesheet"
      href="http://code.jquery.com/ui/1.9.2/themes/base/jquery-ui.css"
      type="text/css"
    />

  {% load static %}
  </head>

  <body>
    <h1><a>Tractor-Trailer Maps </a>

    <div id="map" style="width: 100%; height: 600px"></div>

    <script src="https://unpkg.com/leaflet@1.2.0/dist/leaflet.js"
  integrity="sha512-lInM/apFSqyy1o6s89K4iQUKg6ppXEgsVxT35HbzUupEVRh2Eu9Wdl4tHj7dZO0s1uvplcYGmt3498TtHq+log=="
  crossorigin=""></script>
    <script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
    <script src="http://code.jquery.com/ui/1.9.2/jquery-ui.js"></script>

    <!-- Include this library for mobile touch support  -->
    <script src="http://cdnjs.cloudflare.com/ajax/libs/jqueryui-touch-punch/0.2.2/jquery.ui.touch-punch.min.js"></script>

    <script src="{% static "SliderControl.js" %}"></script>
    <script src="{% static "PruneCluster.js" %}"></script>

    <script>

    //   var sliderControl = null;
       var otherData = {{ other_data | safe }};
       var locationData = {{ location_data | safe }};
       var statesData = {{ us_states | safe }};

       var myMap = L.map("map", {
  }).setView([37.8, -96], 4);

       L.tileLayer("http://{s}.tile.osm.org/{z}/{x}/{y}.png", {
         attribution:
           '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
       }).addTo(myMap);

      function style(feature) {
           return {
               weight: 2,
               opacity: 0,
               fillOpacity: 0
           };
       }

    var geojson;

     function highlightFeature(e) {
        var layer = e.target;

        layer.setStyle({
            weight: 5,
            color: '#666',
            dashArray: '',
            fillOpacity: 0.7
        });
    }

    function resetHighlight(e) {
      geojson.resetStyle(e.target);
    }

    function onEachFeature(feature, layer) {
    layer.on({
        mouseover: highlightFeature,
        mouseout: resetHighlight,
    });
    }

    geojson = L.geoJson(statesData, {style: style, onEachFeature: onEachFeature}).addTo(myMap);

      // Creating a new array of coordinates
      function retrivecoordinates(location){
        for(x =0;x<=661;x++){
          if (locationData['location'][x] == location ){
            return [locationData['latitude'][x],locationData['longitude'][x]];
          }
        }
        return [0,0];
      }

      console.log(otherData);
      console.log(locationData);

      console.log(otherData["saledate"][4]);
      console.log(retrivecoordinates("HOUSTON, TX"));

      var arrayMarkers = [];

      for(i = 0;i<1000;i++){
       // console.log(otherData['location'][i].toString());
      //  console.log(retrivecoordinates(otherData['location'][i].toString()))
      //  console.log("Location: " + retrivecoordinates[otherData['location'][i].toString()]);
        var marker = L.marker(retrivecoordinates(otherData['location'][i].toString()),
         {time: otherData["saledate"][i]});
        arrayMarkers.push(marker);
      }
      console.log(arrayMarkers);

      layerGroup = L.layerGroup(arrayMarkers);
      var sliderControl = L.control.sliderControl({layer:layerGroup});
      myMap.addControl(sliderControl);
      sliderControl.startSlider();

    </script>
  </body>
</html>
